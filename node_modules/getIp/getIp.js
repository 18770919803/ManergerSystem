var os = require('os');
var getClientIp={
    getClientIp:function (req) {
        var ipQz=7;//去掉前缀::ffff:位数为7
        var ip = req.headers['x-forwarded-for'] ||
            req.connection.remoteAddress ||
            req.socket.remoteAddress ||
            (req.connection.socket ? req.connection.socket.remoteAddress : null);
        var iptable = {};
        var  ifaces = os.networkInterfaces();
        for (var dev in ifaces) {
            ifaces[dev].forEach(function(details,alias){
                if (details.family=='IPv4') {
                    iptable[dev+(alias?'_'+alias:'')]=details.address;
                }
            });
        };
        if(ip!="::1" && ip.substring(ipQz)!="127.0.0.1"){
            return ip.substring(ipQz);
        }else{
            return iptable.WLAN_1;
        }
}
}
module.exports=getClientIp;